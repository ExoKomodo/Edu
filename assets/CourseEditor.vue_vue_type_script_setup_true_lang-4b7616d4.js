var P=Object.defineProperty;var U=(c,t,s)=>t in c?P(c,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[t]=s;var x=(c,t,s)=>(U(c,typeof t!="symbol"?t+"":t,s),s);import{C as p,H as h,n as $,d as F,u as H,b as N,p as S,k as l,o as w,f as y,q as g,v as _,a as d,t as V,g as v,m as B,s as M,x as A,l as b,j as D,A as m}from"./index-3492b608.js";import{B as j}from"./BlobService-93622bdb.js";class C{constructor(){x(this,"objectViewKeys",[{key:"id",kind:"text"},{key:"name",kind:"code"},{key:"description",kind:"code"},{key:"content",kind:"code"}])}make(){return new p({})}static async createAsync(t,s={}){var o;try{return new p(await h.postAsync("course",t,s))}catch(r){throw(o=s.toast)==null||o.error(`Failed to create course: ${r}`),r}}static async deleteAsync(t,s={}){var o;try{return new p(await h.deleteAsync("course",t,s))}catch(r){throw(o=s.toast)==null||o.error(`Failed to delete course: ${r}`),r}}static async fillTemplateAsync(t,s={}){if(!t)return"";const o=/"\${([0-9a-zA-Z_\-\/\.]+)}"/g,r=new Map;for(let n of t.matchAll(o)){const e=n[0],f=n[1];e in r||r.set(e,await j.getPresignedUrlAsync(f,s))}for(let[n,e]of r)t=t.replace(n,e);return t}static async getAsync(t,s={}){var o,r;try{const n=new p(await h.getAsync("course",t,s));try{n.templatedContent=await C.fillTemplateAsync(n.content,s)}catch(e){throw(o=s.toast)==null||o.error(`Failed to fill template for course content: ${e}`),e}return n}catch(n){throw(r=s.toast)==null||r.error(`Failed to get course: ${n}`),n}}static async getAllAsync(t={}){var s;try{const o=await h.getAllAsync("course",t);return Object.keys(o).forEach(function(r,n){o[r]=new $(o[r])}),new Map(Object.entries(o))}catch(o){throw(s=t.toast)==null||s.error(`Failed to get all courses: ${o}`),o}}static async updateAsync(t,s={}){var o;try{return new p(await h.putAsync("course",t,s))}catch(r){throw(o=s.toast)==null||o.error(`Failed to update course: ${r}`),r}}}const L={key:0,class:"bg-mysticStone text-white border-slate-400 border-2 rounded p-1 pl-2 my-2"},I=d("div",{class:"text-2xl"},"Course Editor",-1),z={for:"edit-mode"},O=d("label",{for:"show-preview"}," Show preview?",-1),q={key:0},K=d("div",{class:"text-white border-white border-2 rounded p-1 pl-2 my-2 mr-12"},"Name",-1),R={key:0,class:"text-2xl font-bold border-slate-400 rounded border-2 p-1 pl-2"},Z=d("div",{class:"text-white border-white border-2 rounded p-1 pl-2 p my-2 mr-1"},"Description",-1),G=["innerHTML"],J=d("div",{class:"text-white border-white border-2 rounded p-1 pl-2 my-2 mr-8"},"Content",-1),Q=["innerHTML"],W=d("div",{class:"text-white border-white border-2 rounded p-1 pl-2 my-2 mr-12"},"Id",-1),te=F({__name:"CourseEditor",props:{handler:{type:Function},handlerText:{},courseId:{},courseName:{},courseDescription:{},courseContent:{}},async setup(c){let t,s;const o=D(),r=H(),n=c,e=N({isEditMode:!1,showPreview:!1,id:n.courseId,name:n.courseName,description:n.courseDescription,content:n.courseContent,templatedContent:n.courseContent}),f=([t,s]=S(()=>m.getAccessTokenAsync(o,{toast:r})),t=await t,s(),t);async function E(u){u.target.checked&&(e.templatedContent=await C.fillTemplateAsync(e.content,{toast:r,token:f}))}async function T(u){e.showPreview&&(e.templatedContent=await C.fillTemplateAsync(e.content,{toast:r,token:f}))}return(u,a)=>{var k;return l(m).isAdmin(l(o))?(w(),y("div",L,[I,g(d("input",{type:"checkbox",id:"edit-mode",name:"editMode","onUpdate:modelValue":a[0]||(a[0]=i=>e.isEditMode=i)},null,512),[[_,e.isEditMode]]),d("label",z,V(u.handlerText)+" mode?",1),d("span",{class:M(["inline-block",{invisible:!e.isEditMode}])},[v(B,{handler:()=>u.handler(e),text:u.handlerText},null,8,["handler","text"])],2),d("div",{class:M({invisible:!e.isEditMode})},[g(d("input",{type:"checkbox",id:"show-preview",onChange:E,name:"showPreview","onUpdate:modelValue":a[1]||(a[1]=i=>e.showPreview=i)},null,544),[[_,e.showPreview]]),O],2),l(m).isAdmin(l(o))&&e.isEditMode?(w(),y("div",q,[K,v(A,{modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=i=>e.name=i),height:2},null,8,["modelValue"]),l(m).isAdmin(l(o))&&e.isEditMode&&e.showPreview?(w(),y("p",R,V((k=e.name)==null?void 0:k.toUpperCase()),1)):b("",!0),Z,v(A,{modelValue:e.description,"onUpdate:modelValue":a[3]||(a[3]=i=>e.description=i),height:2},null,8,["modelValue"]),l(m).isAdmin(l(o))&&e.isEditMode&&e.showPreview?(w(),y("p",{key:1,class:"text-xl border-slate-400 rounded border-2 p-1 pl-2 my-2",innerHTML:e.description},null,8,G)):b("",!0),J,v(A,{modelValue:e.content,"onUpdate:modelValue":[a[4]||(a[4]=i=>e.content=i),T],language:"html",height:40},null,8,["modelValue"]),l(m).isAdmin(l(o))&&e.isEditMode&&e.showPreview?(w(),y("div",{key:2,class:"text-xl border-slate-400 rounded border-2 p-1 pl-2 my-2",innerHTML:e.templatedContent},null,8,Q)):b("",!0),W,v(A,{modelValue:e.id,"onUpdate:modelValue":a[5]||(a[5]=i=>e.id=i),height:2},null,8,["modelValue"])])):b("",!0)])):b("",!0)}}});export{C,te as _};
